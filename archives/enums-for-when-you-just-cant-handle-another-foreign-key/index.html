
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Enums for When You Just Cant Handle Another Foreign Key - DataChomp</title>
  <meta name="author" content="Rob Sullivan">

  
  <meta name="description" content="If we get over the notion that all data is created equal, it opens up options for us.
For example, your DBA wants some sort of data consistency and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://datachomp.com/archives/enums-for-when-you-just-cant-handle-another-foreign-key">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="DataChomp" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1806527-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">DataChomp</a></h1>
  
    <h2>Chomping At The Bits</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:datachomp.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/books">Books</a></li>
  <li><a href="/speaking">Speaking/Travel</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Enums for When You Just Cant Handle Another Foreign Key</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-29T10:11:00-06:00" pubdate data-updated="true">Jan 29<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If we get over the notion that all data is created equal, it opens up options for us.
For example, your DBA wants some sort of data consistency and integrity&hellip; both very good things
but you are just making a quick little 1 off table that you don&rsquo;t want to sprawl to 4 or 5 tables with foreign keys.</p>

<h4>enum my heart</h4>

<p>For these situations, I like to just use <a href="http://www.postgresql.org/docs/current/static/datatype-enum.html">postgres enums</a>. Check it out:</p>

<pre><code>create type verdict as enum ('gross', 'can eat', 'amazing');

create table burritos (id serial not null primary key, title varchar(50), thoughts verdict not null);
insert into burritos (title, thoughts) values ('road kill burrito', 'yummy');

insert into burritos (title, thoughts) values ('road kill burrito', 'gross');
--Complete Failure

insert into burritos (title, thoughts) values ('grande queso burrito', 'amazing');
--Complete Awesome
</code></pre>

<p>Sweet! We&rsquo;re getting the data we want in, it looks legit, and there is no querying of multiple tables to get the values back.
Another benefit to this is that AppDev isn&rsquo;t continually questioning if they set up the FK correctly.</p>

<h4>blowing in the winds of change</h4>

<p>But how maintainable is it? Say we had a less than ideal experience&hellip; one that requires a lawyer.  need to add to our list:</p>

<pre><code>alter type verdict add value 'lawsuit' before 'gross';
insert into burritos (title, thoughts) values ('putrid plate', 'lawsuit');
</code></pre>

<p>That was pretty easy, though I must say I&rsquo;m a little confused on exactly which values I have in my enum. Good thing we&rsquo;re in a database and can just query it!!!:</p>

<pre><code>select t.typname as enum_name,  
       e.enumlabel as enum_value,
       n.nspname as enum_schema
from pg_type t 
   inner join pg_enum e on t.oid = e.enumtypid  
   inner join pg_catalog.pg_namespace n ON n.oid = t.typnamespace
where t.typname = 'verdict' and n.nspname = 'public'
</code></pre>

<h4>re-fear-factor</h4>

<p>If you are ok with the above code&hellip; then good on you. However, we might want to populate a dropdown or something else in our application based on these values. Neither your typical Rails Dev or ActiveRecord itself is going to try to implement the above without tears of sadness streaming down to their Mac. We can build a bridge by just making a simple view and assigning a self.table_name = to the following:</p>

<pre><code>create view my_lovely_enums as 
select t.typname as enum_name,  
       e.enumlabel as enum_value,
       n.nspname as enum_schema 
from pg_type t 
    inner join pg_enum e on t.oid = e.enumtypid  
    inner join pg_catalog.pg_namespace n ON n.oid = t.typnamespace
where t.typname = 'verdict' and n.nspname = 'public';
</code></pre>

<p>Hardcoding &lsquo;verdict&rsquo; like that creates a pretty brittle where clause. I tend to remove that part and go a little more flexible with a predicate/scope to select your enum of choice:</p>

<pre><code>create or replace view my_lovely_enums as 
select t.typname as enum_name,  
       e.enumlabel as enum_value,
       n.nspname as enum_schema
from pg_type t 
    inner join pg_enum e on t.oid = e.enumtypid  
    inner join pg_catalog.pg_namespace n ON n.oid = t.typnamespace;
select * from my_lovely_enums where enum_name = 'verdict' and n.nspname = 'public';
"verdict";"gross";"public"
"verdict";"can eat";"public"
"verdict";"lawsuit";"public"
"verdict";"burrito dreams";"public"
</code></pre>

<p>For some more information on this topic, check out a lovely write up at <a href="http://postgresguide.com/sexy/enums.html">postgresguide.com</a>. The bottom of that article has this handy little  buyer-beware:<br/>
&ldquo;At the time of this writing, Postgres does not provide a way to remove values from enums.&rdquo;
While this approach can&rsquo;t be used for all situations, using it where you can get creates a tremendous amount of simplicity in your app without compromising integrity &ndash; affectionally known as a win-win.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Rob Sullivan</span></span>

      








  


<time datetime="2014-01-29T10:11:00-06:00" pubdate data-updated="true">Jan 29<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://datachomp.com/archives/enums-for-when-you-just-cant-handle-another-foreign-key/" data-via="datachomp" data-counturl="http://datachomp.com/archives/enums-for-when-you-just-cant-handle-another-foreign-key/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/archives/i-am-a-bad-blogger/" title="Previous Post: I am A bad blogger">&laquo; I am A bad blogger</a>
      
      
        <a class="basic-alignment right" href="/archives/always-get-an-absentee-ballot/" title="Next Post: Always Get An Absentee Ballot">Always Get An Absentee Ballot &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
	<a href="/"><img src="http://static.datachomp.com/datachomp.png" width="236" height="236" alt="Data Eating Alligator" /></a><br/>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/archives/carne-asada-hold-the-self-join/">Carne Asada Hold the Self Join</a>
      </li>
    
      <li class="post">
        <a href="/archives/gaming-on-linux/">Gaming on Linux</a>
      </li>
    
      <li class="post">
        <a href="/archives/personal-twitter-tips-for-maximum-happiness/">Personal Twitter Tips for Maximum Happiness</a>
      </li>
    
      <li class="post">
        <a href="/archives/always-get-an-absentee-ballot/">Always Get an Absentee Ballot</a>
      </li>
    
      <li class="post">
        <a href="/archives/enums-for-when-you-just-cant-handle-another-foreign-key/">Enums for When You Just Cant Handle Another Foreign Key</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Rob Sullivan - Hand-crafted in OK <img src="http://static.datachomp.com/ok.gif" height="15" width="15" /> - 
  <span class="credit">Served by <a href="http://octopress.org">Octopress</a> and Github</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'datachomp';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://datachomp.com/archives/enums-for-when-you-just-cant-handle-another-foreign-key/';
        var disqus_url = 'http://datachomp.com/archives/enums-for-when-you-just-cant-handle-another-foreign-key/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>






<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100787394); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100787394ns.gif" /></p></noscript>
</body>
</html>
