
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Enums for when you just cant hande another foreign key - DataChomp</title>
  <meta name="author" content="Rob Sullivan">

  
  <meta name="description" content="If we get over the notion that all data is created equal, it opens up options for us.
For example, your DBA wants some sort of data consistency and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://datachomp.com/archives/enums-for-when-you-just-cant-hande-another-foreign-key">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="DataChomp" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1806527-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">DataChomp</a></h1>
  
    <h2>Chomping At The Bits</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:datachomp.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="/books">Books</a></li>
  <li><a href="/speaking">Speaking/Travel</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Enums for When You Just Cant Hande Another Foreign Key</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-11T10:11:00-06:00" pubdate data-updated="true">Jan 11<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If we get over the notion that all data is created equal, it opens up options for us.
For example, your DBA wants some sort of data consistency and integrity&hellip; both very good things
but you are just making a quick little 1 off table that you don&rsquo;t want to sprawl to 4 or 5 tables with foreign keys.</p>

<h4>enum my heart</h4>

<p>For these situations, I like to just use <a href="http://www.postgresql.org/docs/current/static/datatype-enum.html">postgres enums</a>. Check it out:</p>

<pre><code>&lt;pre&gt;
create type verdict as enum ('gross', 'can eat', 'amazing');

create table burritos (id serial not null primary key, title varchar(50), thoughts verdict not null);
insert into burritos (title, thoughts) values ('road kill burrito', 'yummy');

insert into burritos (title, thoughts) values ('road kill burrito', 'gross');
--Complete Failure

insert into burritos (title, thoughts) values ('grande queso burrito', 'amazing');
--Complete Awesome
&lt;/pre&gt;
</code></pre>

<p>Sweet! We&rsquo;re getting the data we want in, we&rsquo;re not having to query maintain multiple tables to get our data.
Another benfit to this is that AppDev isn&rsquo;t continually questioning if they set up the FK correctly.</p>

<p>But how maintainble is it?   Say we need to add to our list:</p>

<pre><code>ALTER TYPE verdict ADD VALUE 'lawsuit' BEFORE 'gross';
insert into burritos (title, thoughts) values ('putrid plate', 'lawsuit');
</code></pre>

<h5>query</h5>

<p>How do we know what our valid values are? We can query some system tables like this:</p>

<pre><code>select n.nspname as enum_schema,  
       t.typname as enum_name,  
       e.enumlabel as enum_value
from pg_type t 
   join pg_enum e on t.oid = e.enumtypid  
   join pg_catalog.pg_namespace n ON n.oid = t.typnamespace
where t.typname = 'verdict'
</code></pre>

<p>If you are ok with the above code&hellip; then good on you. However, we might want to populate a dropdown or something else in our application based on these values. Neither your typical Rails Dev or ActiveRecord itself is going to try to implement the above without tears running down their mustache. We can build a bridge by just making a simple view and assigning a self.table_name = to the following:</p>

<pre><code>create view my_lovely_enums as 
select n.nspname as enum_schema,  
       t.typname as enum_name,  
       e.enumlabel as enum_value
from pg_type t 
    inner join pg_enum e on t.oid = e.enumtypid  
    inner join pg_catalog.pg_namespace n ON n.oid = t.typnamespace;
</code></pre>

<p>_</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Rob Sullivan</span></span>

      








  


<time datetime="2014-01-11T10:11:00-06:00" pubdate data-updated="true">Jan 11<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://datachomp.com/archives/enums-for-when-you-just-cant-hande-another-foreign-key/" data-via="datachomp" data-counturl="http://datachomp.com/archives/enums-for-when-you-just-cant-hande-another-foreign-key/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/archives/i-am-a-bad-blogger/" title="Previous Post: I am A bad blogger">&laquo; I am A bad blogger</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
	<a href="/"><img src="http://static.datachomp.com/datachomp.png" width="236" height="236" alt="Data Eating Alligator" /></a><br/>
	<a href="http://tekpub.com/collections/everything/products/pg"><img src="http://static.datachomp.com/pg_thumb.png" alt="Tekpub" width=120 height=80 /></a>
	<br/>
	<a href="http://tekpub.com/collections/everything/products/ft_sullivan"><img src="http://static.datachomp.com/ft_sullivan_thumb.png" alt="Tekpub" /></a>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/archives/enums-for-when-you-just-cant-hande-another-foreign-key/">Enums for When You Just Cant Hande Another Foreign Key</a>
      </li>
    
      <li class="post">
        <a href="/archives/i-am-a-bad-blogger/">I Am a Bad Blogger</a>
      </li>
    
      <li class="post">
        <a href="/archives/the-appdevs-are-idiots/">The AppDevs Are Idiots</a>
      </li>
    
      <li class="post">
        <a href="/archives/getting-started-with-pgbouncer/">Getting Started With PGBouncer</a>
      </li>
    
      <li class="post">
        <a href="/archives/heroku-pg-extras-builds-bridges/">Heroku Pg-extras Builds Bridges</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Rob Sullivan - Hand-crafted in OK <img src="http://static.datachomp.com/ok.gif" height="15" width="15" /> - 
  <span class="credit">Served by <a href="http://octopress.org">Octopress</a> and Github</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'datachomp';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://datachomp.com/archives/enums-for-when-you-just-cant-hande-another-foreign-key/';
        var disqus_url = 'http://datachomp.com/archives/enums-for-when-you-just-cant-hande-another-foreign-key/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
